<!DOCTYPE html>
<html lang="fr">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Oh My Games - Joueurs</title>
Â  Â  <link rel="stylesheet" href="styles.css">
</head>

<body>
Â  Â  <div id="group-info" style="text-align: right; margin-top: 10px; margin-right: 10px;">
Â  Â  Â  Â  <span id="current-group-alias"></span>
Â  Â  Â  Â  <button onclick="location.href='login.html'" style="margin-left: 10px;">Changer de groupe</button>
Â  Â  </div>
Â  Â  <h1>Oh My Games</h1>
Â  Â  <h2>Liste des joueurs</h2>
Â  Â  <img src="omg_img.png" alt="Fond" class="background-image" />

Â  Â  <button class="btn-add">â• Ajouter un joueur</button>

Â  Â  <div id="alpha-filter-container">
Â  Â  </div>

Â  Â  <input type="text" id="recherche-joueurs" placeholder="ğŸ” Rechercher un joueur..." />

Â  Â  <div id="liste-joueurs">
Â  Â  Â  Â  </div>

Â  Â  <div id="modal-ajout" class="modal">
Â  Â  Â  Â  <div id="modal-content" class="modal-content">
Â  Â  Â  Â  Â  Â  <button id="btn-fermer" class="close-button">&times;</button>
Â  Â  Â  Â  Â  Â  <h3>Ajouter/Modifier un joueur</h3>
Â  Â  Â  Â  Â  Â  <form id="form-ajout">
Â  Â  Â  Â  Â  Â  Â  Â  <input type="hidden" id="joueur-id">
Â  Â  Â  Â  Â  Â  Â  Â  <label for="nom-joueur">Nom du joueur :</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="nom-joueur" name="nom-joueur" required><br><br>

Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit">Ajouter le joueur</button>
Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <button class="btn-home" onclick="location.href='index.html'">ğŸ  Home</button>

Â  Â  <script type="module">
Â  Â  Â  Â  console.log("Script joueurs.html chargÃ©.");

Â  Â  Â  Â  import { supabase } from './supabase-config.js';

Â  Â  Â  Â  let joueurs = [];
Â  Â  Â  Â  // partiesStats contiendra toutes les lignes de parties_joueurs
Â  Â  Â  Â  let partiesStats = [];Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Map pour la conversion rapide ID -> Nom, nÃ©cessaire pour l'affichage
Â  Â  Â  Â  let joueurIdToNom = new Map();
Â  Â  Â  Â Â 
Â  Â  Â  Â  const modal = document.getElementById('modal-ajout');
Â  Â  Â  Â  const btnAdd = document.querySelector('.btn-add');
Â  Â  Â  Â  const btnFermer = document.getElementById('btn-fermer');
Â  Â  Â  Â  const formAjout = document.getElementById('form-ajout');
Â  Â  Â  Â  const listeJoueurs = document.getElementById('liste-joueurs');
Â  Â  Â  Â  const inputRecherche = document.getElementById('recherche-joueurs');

Â  Â  Â  Â  const joueurIdInput = document.getElementById('joueur-id');
Â  Â  Â  Â  const nomJoueurInput = document.getElementById('nom-joueur');

Â  Â  Â  Â  let currentAlphaFilter = '';
Â  Â  Â  Â  let selectedGroupId = null;

Â  Â  Â  Â  // --- VÃ©rification et affichage du groupe ---
Â  Â  Â  Â  selectedGroupId = localStorage.getItem('selected_group_id');
Â  Â  Â  Â  if (!selectedGroupId) {
Â  Â  Â  Â  Â  Â  location.href = 'login.html';
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  const selectedGroupAlias = localStorage.getItem('selected_group_alias');
Â  Â  Â  Â  Â  Â  document.getElementById('current-group-alias').textContent = `Groupe : ${selectedGroupAlias}`;
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Fonctions de chargement des donnÃ©es (FiltrÃ©es par groupe_id) ---
Â  Â  Â  Â  async function chargerJoueurs() {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const { data, error } = await supabase
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .from('joueurs')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .select('id, nom')Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .eq('groupe_id', selectedGroupId)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .order('nom', { ascending: true });
Â  Â  Â  Â  Â  Â  Â  Â  if (error) throw error;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Mettre Ã  jour la map de conversion pour les statistiques
Â  Â  Â  Â  Â  Â  Â  Â  joueurIdToNom.clear();
Â  Â  Â  Â  Â  Â  Â  Â  data.forEach(j => joueurIdToNom.set(j.id, j.nom));

Â  Â  Â  Â  Â  Â  Â  Â  return data;
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Erreur lors du chargement des joueurs:", error);
Â  Â  Â  Â  Â  Â  Â  Â  alert(`Une erreur est survenue lors du chargement des joueurs: ${error.message}`);
Â  Â  Â  Â  Â  Â  Â  Â  return [];
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  async function chargerPartiesStats() {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  // RÃ©cupÃ©rer toutes les lignes de la jointure qui nous concernent
Â  Â  Â  Â  Â  Â  Â  Â  const { data, error } = await supabase
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .from('parties_joueurs')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .select('partie_id, joueur_id, est_gagnant, parties(nom_jeu)')Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .eq('parties.groupe_id', selectedGroupId); // Filtrage via la relation
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (error) throw error;
Â  Â  Â  Â  Â  Â  Â  Â  return data;
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Erreur lors du chargement des statistiques de parties:", error);
Â  Â  Â  Â  Â  Â  Â  Â  return [];
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- Fonctions d'ajout/modification/suppression (Aucun changement) ---
Â  Â  Â  Â  async function ajouterJoueur(joueurData) {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  // Utilisation du nom comme alias par dÃ©faut
Â  Â  Â  Â  Â  Â  Â  Â  const { data, error } = await supabase
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .from('joueurs')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .insert({Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ...joueurData,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alias: joueurData.nom,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  groupe_id: selectedGroupIdÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .select();
Â  Â  Â  Â  Â  Â  Â  Â  if (error) throw error;
Â  Â  Â  Â  Â  Â  Â  Â  return { success: true, data: data[0] };
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Erreur lors de l'ajout du joueur:", error);
Â  Â  Â  Â  Â  Â  Â  Â  alert(`Une erreur est survenue lors de l'ajout du joueur: ${error.message}`);
Â  Â  Â  Â  Â  Â  Â  Â  return { success: false, error };
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  async function modifierJoueur(id, joueurData) {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  // Mise Ã  jour du nom et de l'alias (simplifiÃ©)
Â  Â  Â  Â  Â  Â  Â  Â  const { data, error } = await supabase
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .from('joueurs')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .update({ nom: joueurData.nom, alias: joueurData.nom })
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .eq('id', id)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .select();
Â  Â  Â  Â  Â  Â  Â  Â  if (error) throw error;
Â  Â  Â  Â  Â  Â  Â  Â  return { success: true, data: data[0] };
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Erreur lors de la modification du joueur:", error);
Â  Â  Â  Â  Â  Â  Â  Â  alert(`Une erreur est survenue lors de la modification du joueur: ${error.message}`);
Â  Â  Â  Â  Â  Â  Â  Â  return { success: false, error };
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  async function supprimerJoueur(id) {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  // Suppression d'un joueur, Supabase doit gÃ©rer la suppression en cascade dans parties_joueurs
Â  Â  Â  Â  Â  Â  Â  Â  const { error } = await supabase
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .from('joueurs')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .delete()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .eq('id', id);
Â  Â  Â  Â  Â  Â  Â  Â  if (error) throw error;
Â  Â  Â  Â  Â  Â  Â  Â  return { success: true };
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Erreur lors de la suppression du joueur:", error);
Â  Â  Â  Â  Â  Â  Â  Â  alert(`Une erreur est survenue lors de la suppression du joueur: ${error.message}`);
Â  Â  Â  Â  Â  Â  Â  Â  return { success: false, error };
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Listeners de la modale (Aucun changement) ---

Â  Â  Â  Â  btnAdd.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  formAjout.reset();
Â  Â  Â  Â  Â  Â  joueurIdInput.value = '';
Â  Â  Â  Â  Â  Â  formAjout.querySelector('button[type="submit"]').textContent = 'Ajouter le joueur';
Â  Â  Â  Â  Â  Â  modal.style.display = 'flex';
Â  Â  Â  Â  });

Â  Â  Â  Â  btnFermer.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  modal.style.display = 'none';
Â  Â  Â  Â  });

Â  Â  Â  Â  modal.addEventListener('click', (e) => {
Â  Â  Â  Â  Â  Â  if (e.target === modal) {
Â  Â  Â  Â  Â  Â  Â  Â  modal.style.display = 'none';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  formAjout.addEventListener('submit', async (e) => {
Â  Â  Â  Â  Â  Â  e.preventDefault();

Â  Â  Â  Â  Â  Â  const id = joueurIdInput.value;
Â  Â  Â  Â  Â  Â  const nomJoueur = nomJoueurInput.value.trim();

Â  Â  Â  Â  Â  Â  if (!nomJoueur) {
Â  Â  Â  Â  Â  Â  Â  Â  alert('Le nom du joueur est obligatoire.');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const joueurData = { nom: nomJoueur };Â 

Â  Â  Â  Â  Â  Â  let result;
Â  Â  Â  Â  Â  Â  if (id) {
Â  Â  Â  Â  Â  Â  Â  Â  result = await modifierJoueur(id, joueurData);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  result = await ajouterJoueur(joueurData);
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if (result.success) {
Â  Â  Â  Â  Â  Â  Â  Â  alert(`Joueur "${nomJoueur}" ${id ? 'modifiÃ©' : 'ajoutÃ©'} avec succÃ¨s !`);
Â  Â  Â  Â  Â  Â  Â  Â  await chargerEtAfficherJoueurs();
Â  Â  Â  Â  Â  Â  Â  Â  modal.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  formAjout.reset();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  // --- Fonctions d'affichage et de filtrage ---
Â  Â  Â  Â  function generateAlphaFilters() {
Â  Â  Â  Â  Â  Â  const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
Â  Â  Â  Â  Â  Â  const alphaFilterContainer = document.getElementById('alpha-filter-container');
Â  Â  Â  Â  Â  Â  alphaFilterContainer.innerHTML = '';
Â  Â  Â  Â  Â  Â  const allBtn = document.createElement('button');
Â  Â  Â  Â  Â  Â  allBtn.className = 'alpha-filter-btn';
Â  Â  Â  Â  Â  Â  if (currentAlphaFilter === '') allBtn.classList.add('active');
Â  Â  Â  Â  Â  Â  allBtn.textContent = 'Tout';
Â  Â  Â  Â  Â  Â  allBtn.setAttribute('data-filter', '');
Â  Â  Â  Â  Â  Â  alphaFilterContainer.appendChild(allBtn);
Â  Â  Â  Â  Â  Â  alphabet.forEach(letter => {
Â  Â  Â  Â  Â  Â  Â  Â  const btn = document.createElement('button');
Â  Â  Â  Â  Â  Â  Â  Â  btn.className = 'alpha-filter-btn';
Â  Â  Â  Â  Â  Â  Â  Â  if (currentAlphaFilter === letter) btn.classList.add('active');
Â  Â  Â  Â  Â  Â  Â  Â  btn.textContent = letter;
Â  Â  Â  Â  Â  Â  Â  Â  btn.setAttribute('data-filter', letter);
Â  Â  Â  Â  Â  Â  Â  Â  alphaFilterContainer.appendChild(btn);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  alphaFilterContainer.addEventListener('click', (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  if (e.target.classList.contains('alpha-filter-btn')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.alpha-filter-btn').forEach(b => b.classList.remove('active'));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.target.classList.add('active');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentAlphaFilter = e.target.getAttribute('data-filter');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  inputRecherche.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  afficherListeJoueurs();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  async function chargerEtAfficherJoueurs() {
Â  Â  Â  Â  Â  Â  // 1. Chargement des joueurs (pour la map ID -> Nom)
Â  Â  Â  Â  Â  Â  joueurs = await chargerJoueurs();
Â  Â  Â  Â  Â  Â  // 2. Chargement de toutes les stats de parties_joueurs
Â  Â  Â  Â  Â  Â  partiesStats = await chargerPartiesStats();Â 
Â  Â  Â  Â  Â  Â  afficherListeJoueurs();
Â  Â  Â  Â  }

Â  Â  Â  Â  function afficherListeJoueurs() {
Â  Â  Â  Â  Â  Â  listeJoueurs.innerHTML = '';
Â  Â  Â  Â  Â  Â  const filterText = inputRecherche.value.toLowerCase();
Â  Â  Â  Â  Â  Â  const joueursTries = [...joueurs].sort((a, b) => a.nom.localeCompare(b.nom));
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (joueursTries.length === 0 && !filterText && !currentAlphaFilter) {
Â  Â  Â  Â  Â  Â  Â  Â  listeJoueurs.innerHTML = '<p style="text-align: center; color: #666; margin-top: 20px;">Aucun joueur n\'est enregistrÃ©. Ajoutez-en un !</p>';
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  let joueursFiltres = joueursTries.filter(joueur => {
Â  Â  Â  Â  Â  Â  Â  Â  const nomComplet = joueur.nom.toLowerCase();
Â  Â  Â  Â  Â  Â  Â  Â  if (filterText && !nomComplet.includes(filterText)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return false;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  if (currentAlphaFilter && !joueur.nom.toLowerCase().startsWith(currentAlphaFilter.toLowerCase())) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return false;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  return true;
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  if (joueursFiltres.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  listeJoueurs.innerHTML = '<p style="text-align: center; color: #666; margin-top: 20px;">Aucun joueur ne correspond Ã  vos critÃ¨res de recherche.</p>';
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // --- Logique de comptage des victoires avec la table de jointure (CORRIGÃ‰) ---
Â  Â  Â  Â  Â  Â  const statsJoueurs = new Map(); // Key: joueur_id, Value: { partiesJouees: N, victoires: N, jeuxJoues: Set<string>, partiesGagneesParJeu: Map<string, N> }
Â  Â  Â  Â  Â  Â  joueurs.forEach(j => {
Â  Â  Â  Â  Â  Â  Â  Â  statsJoueurs.set(j.id, {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  partiesJouees: 0,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  victoires: 0,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  jeuxJoues: new Set(),Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  partiesGagneesParJeu: new Map()Â 
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  const partiesComptees = new Set(); // Pour compter les parties une seule fois par joueur (mÃªme s'il est co-gagnant)

Â  Â  Â  Â  Â  Â  partiesStats.forEach(line => {
Â  Â  Â  Â  Â  Â  Â  Â  const joueurId = line.joueur_id;
Â  Â  Â  Â  Â  Â  Â  Â  const partieId = line.partie_id;
Â  Â  Â  Â  Â  Â  Â  Â  const nomJeu = line.parties.nom_jeu;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (statsJoueurs.has(joueurId)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const stats = statsJoueurs.get(joueurId);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // 1. Parties JouÃ©es (compte une fois la partie pour le joueur)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!partiesComptees.has(`${joueurId}-${partieId}`)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  stats.partiesJouees++;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  stats.jeuxJoues.add(nomJeu);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  partiesComptees.add(`${joueurId}-${partieId}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // 2. Victoires
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (line.est_gagnant) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  stats.victoires++;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // 3. Jeu Favori
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const currentCount = stats.partiesGagneesParJeu.get(nomJeu) || 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  stats.partiesGagneesParJeu.set(nomJeu, currentCount + 1);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  // --- Affichage des cartes ---
Â  Â  Â  Â  Â  Â  joueursFiltres.forEach((joueur) => {
Â  Â  Â  Â  Â  Â  Â  Â  const card = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  card.className = 'joueur-card';
Â  Â  Â  Â  Â  Â  Â  Â  const stats = statsJoueurs.get(joueur.id) || { partiesJouees: 0, victoires: 0, jeuxJoues: new Set(), partiesGagneesParJeu: new Map() };

Â  Â  Â  Â  Â  Â  Â  Â  // Calcul du jeu favori
Â  Â  Â  Â  Â  Â  Â  Â  let jeuFavori = 'Aucun';
Â  Â  Â  Â  Â  Â  Â  Â  let maxVictoires = 0;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  for (const [jeu, count] of stats.partiesGagneesParJeu.entries()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (count > maxVictoires) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  maxVictoires = count;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  jeuFavori = jeu;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  // --- Photo et nom ---
Â  Â  Â  Â  Â  Â  Â  Â  const headerDiv = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  headerDiv.className = 'joueur-header';
Â  Â  Â  Â  Â  Â  Â  Â  const img = document.createElement('img');
Â  Â  Â  Â  Â  Â  Â  Â  img.src = 'https://via.placeholder.com/100x100?text=ğŸ‘¤';Â 
Â  Â  Â  Â  Â  Â  Â  Â  img.alt = `Photo de ${joueur.nom}`;
Â  Â  Â  Â  Â  Â  Â  Â  img.className = 'joueur-photo';
Â  Â  Â  Â  Â  Â  Â  Â  headerDiv.appendChild(img);

Â  Â  Â  Â  Â  Â  Â  Â  const titre = document.createElement('h3');
Â  Â  Â  Â  Â  Â  Â  Â  titre.textContent = joueur.nom;
Â  Â  Â  Â  Â  Â  Â  Â  headerDiv.appendChild(titre);
Â  Â  Â  Â  Â  Â  Â  Â  card.appendChild(headerDiv);

Â  Â  Â  Â  Â  Â  Â  Â  // --- Affichage des Statistiques ---
Â  Â  Â  Â  Â  Â  Â  Â  const statsDiv = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  statsDiv.className = 'joueur-stats';
Â  Â  Â  Â  Â  Â  Â  Â  statsDiv.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Parties JouÃ©es : <strong>${stats.partiesJouees}</strong></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Victoires : <strong>${stats.victoires}</strong></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Ratio Victoires : <strong>${stats.partiesJouees > 0 ? ((stats.victoires / stats.partiesJouees) * 100).toFixed(1) + '%' : 'N/A'}</strong></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Jeux JouÃ©s : <strong>${stats.jeuxJoues.size}</strong></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Jeu Favori : <strong>${jeuFavori}${maxVictoires > 0 ? ` (${maxVictoires} victoires)` : ''}</strong></p>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  card.appendChild(statsDiv);


Â  Â  Â  Â  Â  Â  Â  Â  // --- Boutons ---
Â  Â  Â  Â  Â  Â  Â  Â  const btns = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  btns.className = 'btns-card';

Â  Â  Â  Â  Â  Â  Â  Â  const btnModifier = document.createElement('button');
Â  Â  Â  Â  Â  Â  Â  Â  btnModifier.className = 'btn-card btn-modifier';
Â  Â  Â  Â  Â  Â  Â  Â  btnModifier.textContent = 'âœï¸ Modifier';
Â  Â  Â  Â  Â  Â  Â  Â  btnModifier.addEventListener('click', (event) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  event.stopPropagation();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ouvrirModaleModifier(joueur.id);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  btns.appendChild(btnModifier);

Â  Â  Â  Â  Â  Â  Â  Â  const btnSupprimer = document.createElement('button');
Â  Â  Â  Â  Â  Â  Â  Â  btnSupprimer.className = 'btn-card btn-supprimer';
Â  Â  Â  Â  Â  Â  Â  Â  btnSupprimer.textContent = 'ğŸ—‘ï¸ Supprimer';
Â  Â  Â  Â  Â  Â  Â  Â  btnSupprimer.addEventListener('click', async (event) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  event.stopPropagation();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (confirm(`Supprimer le joueur "${joueur.nom}" ?`)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await supprimerJoueur(joueur.id);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await chargerEtAfficherJoueurs();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  btns.appendChild(btnSupprimer);

Â  Â  Â  Â  Â  Â  Â  Â  card.appendChild(btns);
Â  Â  Â  Â  Â  Â  Â  Â  listeJoueurs.appendChild(card);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  function ouvrirModaleModifier(id) {
Â  Â  Â  Â  Â  Â  const joueur = joueurs.find(j => j.id === id);
Â  Â  Â  Â  Â  Â  if (!joueur) {
Â  Â  Â  Â  Â  Â  Â  Â  alert("Erreur: Impossible de charger les donnÃ©es du joueur.");
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  joueurIdInput.value = joueur.id;
Â  Â  Â  Â  Â  Â  nomJoueurInput.value = joueur.nom;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  formAjout.querySelector('button[type="submit"]').textContent = 'Modifier le joueur';
Â  Â  Â  Â  Â  Â  modal.style.display = 'flex';
Â  Â  Â  Â  }

Â  Â  Â  Â  inputRecherche.addEventListener('input', () => {
Â  Â  Â  Â  Â  Â  currentAlphaFilter = '';
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.alpha-filter-btn').forEach(b => b.classList.remove('active'));
Â  Â  Â  Â  Â  Â  const allBtn = document.querySelector('.alpha-filter-btn[data-filter=""]');
Â  Â  Â  Â  Â  Â  if (allBtn) allBtn.classList.add('active');
Â  Â  Â  Â  Â  Â  afficherListeJoueurs();
Â  Â  Â  Â  });

Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', async () => {
Â  Â  Â  Â  Â  Â  generateAlphaFilters();
Â  Â  Â  Â  Â  Â  await chargerEtAfficherJoueurs();
Â  Â  Â  Â  });

Â  Â  Â  Â  document.addEventListener('visibilitychange', async () => {
Â  Â  Â  Â  Â  Â  if (document.visibilityState === 'visible') {
Â  Â  Â  Â  Â  Â  Â  Â  await chargerEtAfficherJoueurs();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  </script>
</body>
</html>